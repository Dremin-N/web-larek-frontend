# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Компоненты отображения

### Класс `Component`

Абстрактный класс, который реализует основные методы для отображения элементов на странице

#### Методы:

- `setText` - устанавливает текстовое содержимое

- `setDisabled` - изменяет статус блокировки для кнопки

- `setHidden` - скрывает элемент

- `setVisible` - делает элемент видимым

- `setImage` - устанавливает изображение с альтернативным текстом

- `render` - Возвращает HTML-элемент для отображения

### Классы которые наследуются от `Component`

### 1. Класс `Basket`

Отвечает за отображение Корзины. Хранит поля с HTML элементами для отображения списка товаров, общей суммы заказа и кнопки "Оформить".

Методы:

- `items` - задает список товаров для отображения в корзине
- `total` - устанавливает общую сумму заказа
- `selected` - Меняет статус кнопки "Оформить" в зависимости от наличия товаров в корзине

### 2. Класс `Card`

Базовый класс для отображения карточки товара в трех интерфейсах: в каталоге, превью и корзине. Имеет сеттеры для установки значений в DOM-элементы — `id`, `title`, `category`, `image`, `price`, `description`, `index`.

- #### Класс `CardCatalog` отвечает за отображение в каталоге
- #### Класс `CardPreview` отвечает за отображение в превью
- #### Класс `CardBasket` отвечает за отображение в Корзине

### 3. Класс `Form`

В конструкторе принимает на вход элемент формы и брокер событий, вешает слушатель `input`.

Имеет следующие методы:

- `onInputChange` - следит за изменениями в полях формы
- `valid` - Меняет статус кнопки `submit`

### 4. Класс `Modal`

Класс отвечает за отображения контента в шаблоне модального окна. В конструкторе принимает элемент шаблона и брокер событий.

Методы:

- `set content` - устанавливает контент для модального окна
- `open` - открывает модальное окно
- `close` - закрывает модальное окно

### 5. Класс `Success`

Отвечает за отображение модального окна при успешно оформленном заказе

### 6. Класс `Page`

Отвечает за отображение элементов на главной странице. В полях класса содержатся HTML элементы корзины, каталога, обертки и счетчика корзины.

Методы:

- `counter` - Устанавливает количество товаров в корзине
- `catalog` - Вставляет карточки товаров в контейнер каталога
- `locked` - Блокирует/разблокирует скролл при открытом модально окне

### 7. Класс `Tabs`

Отвечает за отображение переключаемых вкладок в форме оформления заказа

Имеет сеттер `selected`, который переключает состояние у кнопок табов.

### 8. Класс `Order`

Класс наследуется от класса `Form<IOrderForm>` и отвечает за работу с формой заказа, содержащей поля электронной почты, телефона, способа оплаты и адреса.

В классе реализованы сеттеры для установки значений в поля форм. Сохранение введенных данных будет реализовано через событийно-ориентированный подход.

Метод класса `showForm` позволяет переключать форму заказа на следующий этап.

## Компоненты модели

### Класс `EventEmitter`

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.

Класс имеет методы `on`, `off` , `emit` — для подписки на событие, отписки от события и уведомления подписчиков о наступлении события соответственно.

Дополнительно реализованы методы `onAll` и `offAll` — для подписки на все события и сброса всех подписчиков.

Интересным дополнением является метод `trigger` , генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter .

### Класс `Api`

Является базовым классом, который реализует основные методы для взаимодействия с api.

Имеет поля `baseUrl` - строка для запроса и `options` - объект заголовков запроса.

Методы класса:

- `handleResponse` - проверяет статус запроса от сервера, в случае некорректного ответа уводит `Promise` в блок `catch`;
- `get` - метод для отправки GET-запросов
- `post` - метод для отправки POST-запросов

### Класс `CatalogApi`

Наследуется от базового класса `Api`. Реализует основные методы взаимодействия с нужным Api.

- `getproductList` - получаем массив товаров с сервера
- `getProductItem` - Получаем объект товара с сервера
- `orderProducts` - Отправляем данные покупателя при офрмлении заказа на сервер

### Класс `Model`

Абстрактный класс, который служит для реализации моделей данных. В конструкторе принимает объект данных и универсальный брокер событий. Имеет метод `emitChanges`, который уведомляет все слушатели, что произошло событие и если слушатели найдены, они срабатывают.

### Класс `AppState`

Наследуется от класса `Model` и имеет следующие поля:

1. `basket` - содержит массив id товаров в корзине
2. `catalog` - содержит массив товаров в каталоге
3. `order` - содержит данные о заказе
4. `preview` - содержит данные об id товара для превью
5. `formErrors`- содержит данные об ошибках в полях ввода

#### Методы:

- `toggleOrderedItem` - добавляет и удаляет товары из корзины
- `clearBasket` - очищает корзину с товарами
- `getTotal` - получает сумму всех товаров в корзине
- `setCatalog` - устанавливает список товаров для каталога
- `setPreview` - устанавливает товар в режим превью
- `setOrderField` - сохраняет введеные пользователем данные в поля заказа
- `validateOrder` - Валидирует поля форм

Взаимодействие Модели с Отображением осуществляется в индексном файле, путем событийно-ориентированного подхода.

#### Пример:

```
// index.ts

events.on('card:select', (item: IProduct) => {
	appData.setPreview(item);
});
```

В данном примере в метод брокера события `events.on` вешает слушатель `card:select`. При срабатывании события реализуется метод модели `setPreview`, который устанвливает для модального окна Превью нужный товар.
